name: Build and Test Workflow
on: 
  pull_request:
    types: [opened, synchronize]
  workflow_dispatch:
    inputs:
      FVT_APIML_ARTIFACT:
        description: 'APIML build for integration test'
        required: true
        default: 'libs-release-local/org/zowe/apiml/sdk/zowe-install/*/zowe-install-*.zip'
      FVT_API_ARTIFACT:
        description: 'Jobs API artifact download pattern'
        required: true
        default: 'libs-snapshot-local/org/zowe/explorer/jobs/*/jobs-api-package-*.zip'
      FVT_ZOSMF_HOST:
        description: 'z/OSMF server for integration test'
        required: true
        default: 'zzow01.zowe.marist.cloud'
      FVT_ZOSMF_PORT:
        description: 'z/OSMF port for integration test'
        required: true
        default: '10443'
      FVT_SERVER_HOSTNAME:
        description: 'Server hostname for integration test'
        required: true
        default: 'fvt-test-server'
      API_ML_DEBUG_PROFILES:
        description: 'Debug profiles for API Gateway'
        required: true
        default: 'default'


jobs:
  check-permission:
    runs-on: macos-latest
    steps:
      - name: check permission
        uses: zowe-actions/global-setup/permission-check@main
        with:
            user: ${{ github.actor }}
            github_repo: ${{ github.repository }}
            github_user: ${{ secrets.ZOWE_ROBOT_USER }}
            github_passwd: ${{ secrets.ZOWE_ROBOT_TOKEN }}

  build:
    runs-on: macos-latest
    needs: check-permission
    steps: 
      - name: Checkout
        uses: actions/checkout@v2

      - name: Apply Global Environment Variables
        uses: zowe-actions/global-setup/envvars-global@main
      
      - name: Setup Node.js Enviornment
        uses: actions/setup-node@v2
        with:
          node-version: ${{ env.DEFAULT_NODE_VERSION }}

      - name: Run generic setup
        uses: zowe-actions/global-setup/generic-setup@main
       
      - name: Nodejs setup action
        uses: zowe-actions/NodeJS-actions/setup-action@setup
        with:
          packageName: 'org.zowe.explorer-jes'
          nodeJsVersion: 'v10.18.1'
          installRegistry_registry: ${{ env.DEFAULT_NPM_PRIVATE_INSTALL_REGISTRY }}
          installRegistry_email: ${{ secrets.NPM_PRIVATE_REGISTRY_EMAIL }}
          installRegistry_username: ${{ secrets.NPM_PRIVATE_REGISTRY_USERNAME }}
          installRegistry_password: ${{ secrets.NPM_PRIVATE_REGISTRY_PASSWORD }}
          publishRegistry_email: ${{ secrets.NPM_PRIVATE_REGISTRY_EMAIL }}
          publishRegistry_username: ${{ secrets.NPM_PRIVATE_REGISTRY_USERNAME }}
          publishRegistry_password: ${{ secrets.NPM_PRIVATE_REGISTRY_PASSWORD }}
          


      # to access inputs, call ${{ github.event.inputs.SOMETHING }}